<!doctype html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Take pity</title>
	<meta name="author" content="Liksu">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="main.css">
</head>
<body>

<div class="switcher">
	<span id="male" onclick="setSex('male')"></span>
	<span id="female" onclick="setSex('female')"></span>
</div>
<p id="phrase">&nbsp;</p>
<p class="button_holder">
	<button id="button" onclick="complain(this)">Complain</button>
</p>

<img src="" id="bear">

<script>(function() {
	/* config */

	var text = {
		en: {
			button: 'Complain',
			secondary: 'Complain again',
			switcher: ['male', 'female'],
			answers: {
				female: ['You my sweet bunny'],
				male: ['All will be good, bro']
			}
		},
		uk: {
			button: 'Пожалітися',
			secondary: 'Пожалітися знову',
			switcher: ['чоловік', 'жінка'],
			answers: {
				female: [
					'Ти ж моє бідолашне зайченя'
				],
				male: []
			}
		},
		ru: {
			button: 'Пожаловаться',
			secondary: 'Пожаловаться ещё раз',
			switcher: ['парень', 'девушка'],
			answers: {
				female: [
					  'Ах ты моя бедненькая!'
					, 'Ты мой бедный зайчик!'
				],
				male: [
					  'Всё будет хорошо'
					, 'Переживешь!'
				]
			}
		}
	};

	var bears = {
		male: [{
			url: '/images/beer/beer_mug.png',
			style: {left: '32px', bottom: '16px'}
		}],
		female: [{
			url: '/images/bears/with_heart.png',
			style: {left: '16px'}
		}]
	};

	/* main */

	var phrase = $id('phrase');
	var bear = $id('bear');
	var button = $id('button');
	var currentBear, sex;

	setSex('female');

	var language = navigator.languages ? navigator.languages[0] : (navigator.language || navigator.userLanguage);
	language = language.split('-')[0];
	text = text[language] || text.en;

	button.innerHTML = text.button;
	$id('male').innerHTML = text.switcher[0];
	$id('female').innerHTML = text.switcher[1];

	function complain() {
		phrase.innerHTML = getRandom(text.answers[sex], phrase.innerHTML) || ':(';
		if (text.answers[sex].length <= 1) hide(button);
		else {
			button.className = 'secondary';
			button.innerHTML = text.secondary;
		}
		setBear();
	}

	/* helpers */

	function $id(id) { return document.getElementById(id) }

	function getRandom(array, current) {
		var result;
		do {
			result = array[Math.random() * array.length | 0]
		} while (array.length > 1 && result == current);
		return result;
	}

	function hide(el) {
		if (typeof el === 'string') el = $id(el);
		el.style.visibility = 'hidden';
	}

	function show(el) {
		if (typeof el === 'string') el = $id(el);
		el.style.visibility = 'visible';
	}

	function setStyle(el, style, clear) {
		for (var key in style)
			el.style[key] = clear ? '' : style[key];
	}

	/* functional helpers */

	function setBear() {
		show(bear);
		if (currentBear) setStyle(bear, currentBear.style, 'clear');

		currentBear = getRandom(bears[sex]);
		if (!currentBear) return;

		bear.src = currentBear.url;
		bear.className = currentBear.class || '';
		setStyle(bear, currentBear.style);
	}

	// start or restart page
	function setSex(value) {
		sex = value;
		$id('male').className = '';
		$id('female').className = '';
		$id(sex).className = 'active';
		document.body.className = sex;
		phrase.innerHTML = '&nbsp;';
		hide(bear);
		show(button);
		button.className = '';
		button.innerHTML = text.button;
	}

	// global actions
	window.complain = complain;
	window.setSex = setSex;
})()</script>

<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
				(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-75866163-1', 'auto');
	ga('send', 'pageview');
</script>
</body>
</html>